## 书籍信息

- 书名: 微服务设计模式和最佳实践
- 作者: [美] 维尼休斯·弗多萨·帕切科 著，程晓磊 译
- 出版社: 清华大学出版社
- 来源: 纸书
- 源代码: [github](https://github.com/PacktPublishing/Microservice-Patterns-and-Best-Practices)

## 简介

作者通过一个新闻网站的例子讨论了微服务设计中的各种模式.

微服务的特性:

- 独立部署
- 独立更新
- 可扩展性
  - x 轴: 水平分解, 通过多实例实现
  - y 轴: 功能分解
  - z 轴: 数据分区
- 替换: 低耦合 高内聚

通信工具:

- 同步通信
  - HTTP RESTful
  - 二进制通信
    - MessagePack
    - gRPC
    - Apache Avro
    - Apache Thrift
- 异步通信
  - 消息代理
    - ActiveMQ
    - RabbitMQ
    - Kafka

缓存优先策略: 将缓存直接作为主要的数据源, 数据的基本操作都在缓存中完成, 同时使用队列机制,
在后台对数据执行规范化操作, 并同步到常规数据库中.

CQRS: 命令查询职责分离, 通过将分离数据的读写职责, 可以针对不同的场景使用不同的物理存储.
比如, 将查询操作在独立的数据库中以同步的方式完成, 将写入操作在独立的数据库中以异步的方式完成.

事件源: 使用 append only 模式, 对数据不进行更新操作, 而是通过版本号记录变更,
可以获取某个对象的所有历史操作与回放.

CQRS 和事件源通常是联合使用, 本书的例子中, 作者使用关系型数据库 PostgreSQL 存储事件源,
并使用非关系型数据库 MongoDB 作为状态层, 保存最新状态的数据, 以便无需从头回放数据至最新状态.

## 共享数据微服务模式

使用单一的数据层, 对应用层部分使用微服务模式.

优点: 便于单体应用迁移到微服务架构上.

## 聚合器微服务模式

编排整合来自底层多个微服务的数据, 对外提供单一的访问点.

最佳实践:

- 分离数据库可较好地对应用程序进行扩展, 尤其是数据存储层
- 封装微服务可以将微服务划分为两个层级, 面向公共服务和内部服务
- 使用 CQRS
- 使用事件源
- 使用可扩展的模式

## 代理微服务模式

使用代理整合微服务.

## 链式微服务模式

单个微服务无法满足全部要求, 因此需要调用其他微服务.

容易出现的问题是循环调用, 以及调用链过长.

## 分支微服务模式

分支微服务模式是聚合微服务模式的扩展, 并支持两个微服务链的同步响应处理.

允许微服务之间的直接同步通信, 但限制长调用链的存在. 同时使用聚合器模式提供单一端点.

## 异步消息微服务模式

使用消息代理和队列, 不关注结果, 不要求同步响应.
